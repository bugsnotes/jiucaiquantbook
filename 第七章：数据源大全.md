# 第七章：数据源大全

数据是量化交易的基础。本章全面介绍免费和付费数据源，并提供完整的使用指南。

---

## 6.1 免费数据源

### Tushare Pro

#### 平台介绍

**Tushare Pro**:
```
定位: 最流行的免费金融数据接口
官网: tushare.pro
作者: Jimmy(国内量化大神)
成立: 2015年(Tushare 1.0), 2018年升级Pro版

特点:
- 数据丰富
- 免费使用(积分制)
- Python接口
- 更新及时
- 社区活跃

覆盖:
- A股全市场
- 指数数据
- 基金数据
- 期货、期权
- 财务数据
- 资金流向
```

#### 注册与使用

**Step 1: 注册获取Token**:
```python
# 访问 tushare.pro 注册
# 获取Token (类似密钥)
# 例如: 1234567890abcdef

# 免费额度:
# 120积分/天
# 每个接口消耗不同积分
# 基础行情: 1-5分/次
# 财务数据: 100-400分/次
```

**Step 2: 安装**:
```python
# 安装Tushare
pip install tushare

# 或指定版本
pip install tushare==1.2.89
```

**Step 3: 初始化**:
```python
import tushare as ts

# 设置Token
ts.set_token('你的token')

# 初始化接口
pro = ts.pro_api()

# 测试
df = pro.daily(ts_code='000001.SZ', start_date='20230101', end_date='20231231')
print(df.head())
```

#### 主要数据接口

**1. 日线行情**:
```python
# 获取平安银行2023年日线数据
df = pro.daily(
    ts_code='000001.SZ',      # 股票代码
    start_date='20230101',    # 开始日期
    end_date='20231231'       # 结束日期
)

# 返回字段:
# ts_code: 股票代码
# trade_date: 交易日期
# open: 开盘价
# high: 最高价
# low: 最低价
# close: 收盘价
# pre_close: 昨收价
# change: 涨跌额
# pct_chg: 涨跌幅%
# vol: 成交量(手)
# amount: 成交额(千元)
```

**2. 周线/月线**:
```python
# 周线
df = pro.weekly(ts_code='000001.SZ', start_date='20230101')

# 月线
df = pro.monthly(ts_code='000001.SZ', start_date='20230101')
```

**3. 实时行情**(需要更高权限):
```python
# 当前行情
df = ts.get_realtime_quotes('000001')

# 注意:
# - 有延迟(15分钟)
# - 需要积分
# - 量化交易一般不用实时,用日线足够
```

**4. 股票列表**:
```python
# 获取所有股票基本信息
df = pro.stock_basic(
    exchange='',              # 交易所: SSE上交所, SZSE深交所
    list_status='L',          # L上市, D退市, P暂停
    fields='ts_code,symbol,name,area,industry,list_date'
)

# 返回:
# ts_code: 代码
# symbol: 代码(不含后缀)
# name: 名称
# area: 地域
# industry: 行业
# list_date: 上市日期
```

**5. 财务数据**:
```python
# 利润表
df = pro.income(
    ts_code='000001.SZ',
    start_date='20200101',
    end_date='20231231',
    fields='ts_code,end_date,revenue,n_income,dt_eps'
)

# 资产负债表
df = pro.balancesheet(ts_code='000001.SZ', start_date='20200101')

# 现金流量表
df = pro.cashflow(ts_code='000001.SZ', start_date='20200101')

# 财务指标
df = pro.fina_indicator(ts_code='000001.SZ', start_date='20200101')
# 包含: ROE, 净利率, 资产负债率等
```

**6. 指数数据**:
```python
# 指数日线
df = pro.index_daily(ts_code='000300.SH', start_date='20230101')
# 000300.SH: 沪深300
# 000905.SH: 中证500
# 000852.SH: 中证1000

# 指数成分股
df = pro.index_weight(index_code='000300.SH', start_date='20230101')
```

**7. 资金流向**:
```python
# 个股资金流
df = pro.moneyflow(ts_code='000001.SZ', start_date='20230101')

# 字段:
# buy_sm_amount: 小单买入金额
# buy_md_amount: 中单买入金额
# buy_lg_amount: 大单买入金额
# buy_elg_amount: 特大单买入金额
```

#### 积分攻略

**获取积分**:
```
方式1: 注册送120分/天
- 够基本使用
- 简单策略足够

方式2: 捐赠升级
- 捐赠100元 → 200分/天
- 捐赠500元 → 500分/天
- 捐赠2000元 → 2000分/天

方式3: 社区贡献
- 分享代码
- 帮助他人
- 写教程
- 获得额外积分奖励

方式4: 邀请新用户
- 邀请注册
- 获得积分
```

**节省积分技巧**:
```
1. 批量获取
   - 一次获取多只股票
   - 比多次单独获取省积分

2. 缓存数据
   - 下载后保存到本地
   - 避免重复下载

3. 选择合适接口
   - 日线数据:积分少
   - 分钟线/财务数据:积分多
   - 优先用低积分接口

4. 定时更新
   - 每天定时下载一次
   - 保存到数据库
   - 避免频繁调用
```

#### 优缺点

**优点**:
```
✓ 完全免费(基础功能)
✓ 数据覆盖全面
✓ Python接口友好
✓ 社区支持好
✓ 更新及时
✓ 文档详细
```

**缺点**:
```
✗ 积分制限制
✗ 高频数据需要更多积分
✗ 部分数据可能有延迟
✗ 稳定性依赖服务器
✗ 不适合机构级使用
```

### AKShare

#### 平台介绍

**AKShare**:
```
定位: 完全免费的数据接口
GitHub: https://github.com/akfamily/akshare
作者: Albert King
理念: 数据应该免费共享

特点:
- 100%免费
- 无需注册
- 无需Token
- 数据来源广
- 持续更新

覆盖:
- A股、港股、美股
- 期货、期权
- 基金、债券
- 外汇、数字货币
- 宏观经济数据
- 新闻舆情
```

#### 安装与使用

**安装**:
```python
pip install akshare

# 升级到最新版
pip install akshare --upgrade
```

**导入**:
```python
import akshare as ak

# 无需Token,直接使用
```

#### 主要接口

**1. A股数据**:
```python
# 实时行情(东方财富)
df = ak.stock_zh_a_spot_em()
# 返回所有A股实时数据

# 历史行情
df = ak.stock_zh_a_hist(
    symbol="000001",           # 不需要后缀
    period="daily",            # daily/weekly/monthly
    start_date="20230101",
    end_date="20231231",
    adjust="qfq"               # 前复权: qfq, 后复权: hfq, 不复权: ""
)

# 字段:
# 日期, 开盘, 收盘, 最高, 最低, 成交量, 成交额, 振幅, 涨跌幅, 涨跌额, 换手率
```

**2. 指数数据**:
```python
# 指数实时
df = ak.stock_zh_index_spot()

# 指数历史
df = ak.stock_zh_index_daily(symbol="sh000300")  # 沪深300

# 指数成分
df = ak.index_stock_cons(symbol="000300")
```

**3. 资金流向**:
```python
# 个股资金流
df = ak.stock_individual_fund_flow(stock="000001", market="深证")

# 板块资金流
df = ak.stock_sector_fund_flow_rank(indicator="今日")

# 主力资金
df = ak.stock_main_fund_flow(symbol="000001")
```

**4. 财务数据**:
```python
# 财务报表
df = ak.stock_financial_report_sina(stock="000001", symbol="资产负债表")
# symbol可选: 资产负债表, 利润表, 现金流量表

# 业绩预告
df = ak.stock_yjyg_em(date="2023-12-31")

# 业绩报表
df = ak.stock_yjbb_em(date="2023-12-31")
```

**5. 龙虎榜**:
```python
# 每日龙虎榜
df = ak.stock_lhb_detail_daily_sina(date="20231215")

# 个股龙虎榜
df = ak.stock_lhb_stock_statistic_sina(symbol="000001")
```

**6. 新闻数据**:
```python
# 东方财富新闻
df = ak.stock_news_em(symbol="000001")

# 返回: 标题, 内容, 发布时间, 来源
```

**7. 宏观数据**:
```python
# GDP
df = ak.macro_china_gdp()

# CPI
df = ak.macro_china_cpi()

# PMI
df = ak.macro_china_pmi()

# 利率
df = ak.macro_china_interest_rate()
```

**8. 行业板块**:
```python
# 行业板块实时
df = ak.stock_board_industry_name_em()

# 板块成分
df = ak.stock_board_industry_cons_em(symbol="小金属")

# 概念板块
df = ak.stock_board_concept_name_em()
```

#### 使用示例

**例子1: 获取沪深300成分股**:
```python
import akshare as ak
import pandas as pd

# 获取沪深300成分
stocks = ak.index_stock_cons(symbol="000300")

# 遍历获取每只股票数据
data_list = []
for code in stocks['品种代码']:
    try:
        df = ak.stock_zh_a_hist(
            symbol=code,
            period="daily",
            start_date="20230101",
            end_date="20231231",
            adjust="qfq"
        )
        df['code'] = code
        data_list.append(df)
        print(f"已获取{code}")
    except:
        print(f"获取{code}失败")

# 合并
all_data = pd.concat(data_list, ignore_index=True)
all_data.to_csv('hs300_data.csv', index=False)
```

**例子2: 每日龙虎榜分析**:
```python
# 获取最近一周龙虎榜
import datetime

dates = pd.date_range(end=datetime.date.today(), periods=7, freq='D')

lhb_data = []
for date in dates:
    date_str = date.strftime('%Y%m%d')
    try:
        df = ak.stock_lhb_detail_daily_sina(date=date_str)
        lhb_data.append(df)
    except:
        continue

# 合并分析
all_lhb = pd.concat(lhb_data)

# 统计最常上榜的股票
top_stocks = all_lhb['代码'].value_counts().head(10)
print("最近一周频繁上榜股票:")
print(top_stocks)
```

#### 优缺点

**优点**:
```
✓ 完全免费
✓ 无需注册
✓ 数据覆盖极广
✓ 包含很多特色数据(龙虎榜、资金流等)
✓ 持续更新
✓ 开源,可查看源码
```

**缺点**:
```
✗ 数据来源不统一(爬取多个网站)
✗ 稳定性较差(依赖数据源)
✗ 可能被反爬
✗ 数据质量参差
✗ 不适合生产环境
✗ 无技术支持
```

### 新浪/网易财经接口

#### 新浪财经

**实时行情**:
```python
import requests

# 实时行情接口
url = 'http://hq.sinajs.cn/list=sz000001'
r = requests.get(url)

# 返回数据解析
data = r.text.split(',')
# [0]: 股票名称
# [1]: 今开
# [2]: 昨收
# [3]: 当前价
# [4]: 今日最高
# [5]: 今日最低
# [6]: 买一价
# ...

# 多只股票
codes = 'sz000001,sh600000,sh600519'
url = f'http://hq.sinajs.cn/list={codes}'
```

**历史数据**:
```python
# 使用AKShare的新浪接口
import akshare as ak

df = ak.stock_zh_a_hist_sina(symbol='000001')
```

#### 网易财经

**日线数据**:
```python
# 历史数据接口
code = '0000001'  # 深市前面加0, 沪市加1
url = f'http://quotes.money.163.com/service/chddata.html?code={code}&start=20200101&end=20231231'

import pandas as pd
df = pd.read_csv(url, encoding='gbk')

# 字段:
# 日期, 开盘价, 最高价, 最低价, 收盘价, 成交量, 成交金额, 涨跌幅
```

#### 优缺点

**优点**:
```
✓ 完全免费
✓ 无需注册
✓ 接口简单
✓ 数据稳定
```

**缺点**:
```
✗ 数据不全面
✗ 只有基础行情
✗ 无财务数据
✗ 可能随时关闭
✗ 无官方文档
✗ 不建议依赖
```

### 交易所官方数据

#### 上海证券交易所

**官网**: www.sse.com.cn

**可获取数据**:
```
- 股票列表
- 公司公告
- 财务报告
- 上市公司信息
- 指数数据
- 统计数据
```

**获取方式**:
- 网页下载
- 部分数据有API(需申请)

#### 深圳证券交易所

**官网**: www.szse.cn

**类似上交所**:
- 基本信息
- 公告数据
- 市场数据

#### 优缺点

**优点**:
```
✓ 官方数据,最权威
✓ 准确性最高
✓ 免费
```

**缺点**:
```
✗ 接口复杂或无接口
✗ 需要手动下载
✗ 格式不统一
✗ 不便于程序化获取
✗ 有延迟
```

### 其他免费数据源汇总

**1. 巨潮资讯(cninfo.com.cn)**:
```
- 公司公告
- 定期报告
- 临时公告
- 需要解析PDF
```

**2. 东方财富Choice数据**:
```
- 有免费接口
- 通过AKShare可获取
- 数据较全
```

**3. 同花顺iFind**:
```
- 部分数据免费
- 主要靠软件
- API收费
```

**4. GitHub开源数据**:
```
- 搜索 "stock data china"
- 很多爱好者分享
- 质量参差不齐
```

---

## 6.2 付费数据源

### Wind金融终端

#### 平台介绍

**Wind资讯**:
```
定位: 中国金融数据行业领导者
官网: www.wind.com.cn
成立: 1994年
地位: 业内标准,机构首选

特点:
- 数据最权威
- 覆盖最全面
- 更新最及时
- 机构标准
- 价格最高

覆盖:
- A股、港股、美股
- 债券、基金
- 期货、期权、衍生品
- 宏观经济
- 行业研究
- 新闻资讯
```

#### 数据类型

**1. 市场数据**:
```
行情数据:
- 日线、分钟线、Tick
- 全市场覆盖
- 历史数据完整(可回溯几十年)

衍生数据:
- 技术指标
- 资金流向
- 板块轮动
```

**2. 基本面数据**:
```
财务数据:
- 三大报表
- 财务指标(200+)
- 业绩预告
- 财务附注

公司数据:
- 股东数据
- 高管信息
- 股权结构
- 分红配股
```

**3. 宏观与行业**:
```
宏观数据:
- GDP、CPI、PMI
- 货币供应
- 利率汇率
- 国际经济

行业数据:
- 行业分类
- 行业指标
- 产业链数据
```

**4. 研究报告**:
```
- 券商研报
- 行业报告
- 公司深度
- 宏观策略
```

#### API接口

**Wind Python API (WindPy)**:
```python
# 安装(需要先安装Wind客户端)
# 从Wind官网下载WindPy

# 导入
from WindPy import w

# 启动
w.start()

# 获取日线数据
data = w.wsd(
    "000001.SZ",           # 股票代码
    "open,high,low,close,volume",  # 字段
    "2023-01-01",          # 开始日期
    "2023-12-31",          # 结束日期
    ""                     # 其他参数
)

# 数据处理
import pandas as pd
df = pd.DataFrame(data.Data, index=data.Fields, columns=data.Times).T

# 获取实时行情
rt = w.wsq("000001.SZ,600000.SH", "rt_last,rt_vol", func=callback_func)

# 停止
w.stop()
```

**主要函数**:
```
w.wsd(): 日线数据
w.wsi(): 分钟线数据
w.wsq(): 实时行情
w.wss(): 横截面数据
w.wst(): Tick数据
w.edb(): 宏观经济数据
w.wset(): 板块数据
```

#### 定价

**个人版**:
```
价格: 约4万元/年
- 基础数据
- Wind终端
- Excel插件
- Python API
```

**机构版**:
```
价格: 十几万到几十万/年
- 根据席位数
- 全部数据
- 专属服务
- 定制开发
```

#### 优缺点

**优点**:
```
✓ 数据最全最权威
✓ 质量最高
✓ 机构标准
✓ 研报丰富
✓ 服务专业
```

**缺点**:
```
✗ 价格极高
✗ 需要本地客户端
✗ 个人难以承受
✗ API依赖客户端
✗ 不适合个人投资者
```

### Choice东方财富

#### 平台介绍

**Choice金融终端**:
```
定位: 国产金融终端
公司: 东方财富
官网: choice.eastmoney.com
成立: 2010年

特点:
- 本土化强
- 价格适中
- 数据全面
- 更新及时

定位:
- Wind平替
- 性价比高
- 个人可承受
```

#### 数据类型

```
市场数据:
- A股全市场行情
- 分钟、日线、Tick
- 港股、美股

基本面:
- 财务报表
- 财务指标
- 估值数据

资金数据:
- 北向资金
- 融资融券
- 大宗交易
- 龙虎榜

特色数据:
- 东方财富独家
- 舆情分析
- 股吧情绪
```

#### API接口

**Choice Python接口**:
```python
# 需要安装Choice客户端和SDK
from ChoiceDataApi import *

# 登录
c = choice_login('username', 'password')

# 获取日线
df = c.csd(
    "000001.SZ,600000.SH",  # 代码
    "OPEN,HIGH,LOW,CLOSE",  # 字段
    "20230101",             # 开始
    "20231231",             # 结束
    "period=1,adjustflag=1" # 参数
)

# 获取财务数据
finance = c.css(
    "000001.SZ",
    "NETPROFIT,TOTAL_REVENUE",
    "2023-09-30"
)

# 登出
c.logout()
```

#### 定价

**个人专业版**:
```
价格: 约6000-8000元/年
- 全市场数据
- API接口
- 历史数据
- 适合个人
```

**机构版**:
```
价格: 2万-5万/年
- 多席位
- 更多服务
```

#### 优缺点

**优点**:
```
✓ 价格合理(比Wind便宜很多)
✓ 数据全面
✓ 本土化好
✓ 有特色数据(东财独家)
✓ 个人可承受
```

**缺点**:
```
✗ 品牌不如Wind
✗ 部分数据质量稍逊
✗ 仍需客户端
✗ 价格相对较高
```

### 聚宽/米筐数据服务

#### 聚宽数据

**JQData**:
```
定位: 聚宽旗下数据服务
官网: www.joinquant.com/data
特点: 专为量化设计

价格:
- 试用版: 免费(每日限额)
- 入门版: 199元/月
- 专业版: 499元/月
- 旗舰版: 999元/月
```

**使用示例**:
```python
# 安装
pip install jqdatasdk

# 导入
import jqdatasdk as jq

# 认证
jq.auth('username', 'password')

# 获取数据
df = jq.get_price(
    '000001.XSHE',
    start_date='2023-01-01',
    end_date='2023-12-31',
    frequency='daily',
    fields=['open', 'close', 'high', 'low', 'volume']
)

# 获取财务数据
q = jq.query(
    jq.valuation.code,
    jq.valuation.pe_ratio,
    jq.valuation.pb_ratio
).filter(
    jq.valuation.code == '000001.XSHE'
)
df = jq.get_fundamentals(q, '2023-12-31')

# 获取全市场
stocks = jq.get_all_securities(['stock'])
```

#### 米筐数据

**RQData**:
```
定位: 米筐旗下数据服务
官网: www.ricequant.com/data
特点: 高质量,专业

价格:
- 按需购买
- 约300-1000元/月
```

**使用**:
```python
# 安装
pip install rqdatac

# 导入
import rqdatac as rq

# 初始化
rq.init('username', 'password')

# 获取数据
df = rq.get_price(
    '000001.XSHE',
    start_date='2023-01-01',
    end_date='2023-12-31',
    frequency='1d',
    fields=['open', 'close', 'high', 'low', 'volume']
)

# 获取因子
factor = rq.get_factor(
    '000001.XSHE',
    'pe_ratio',
    '2023-01-01',
    '2023-12-31'
)
```

#### 优缺点

**聚宽/米筐优点**:
```
✓ 专为量化设计
✓ API友好
✓ 与策略平台集成
✓ 价格适中
✓ 文档完善
```

**缺点**:
```
✗ 覆盖不如专业终端
✗ 主要面向策略开发
✗ 部分高级功能收费
```

### 通联数据

**DataYes**:
```
定位: 专业量化数据服务商
官网: www.datayes.com
特点: 机构级数据

覆盖:
- 高频数据
- 因子数据
- 另类数据
- 专业服务

价格:
- 按数据类型单独定价
- 一般较贵
- 适合机构

优点:
✓ 数据质量高
✓ 高频数据齐全
✓ 因子库丰富

缺点:
✗ 价格贵
✗ 不适合个人
```

### 天软数据

**天软Tinysoft**:
```
定位: 老牌数据服务商
特点: 自有编程语言TSL

用户:
- 主要是机构
- 私募量化常用

价格:
- 较高
- 不太透明

说明:
- TSL语言学习成本高
- 个人不推荐
```

---

## 6.3 数据源选择决策树

### 根据预算选择

**预算0元(学习阶段)**:
```
首选: Tushare Pro(免费版)
备选: AKShare

理由:
- 完全免费
- 足够学习使用
- 开发简单策略
- 不适合实盘

推荐:
1. 注册Tushare Pro
2. 获取免费积分
3. 配合AKShare补充
4. 本地缓存数据
```

**预算 100-300元/月(个人初级)**:
```
首选: 聚宽数据(199元/月)
备选: Tushare Pro捐赠版

理由:
- 数据质量提升
- 适合小资金实盘
- 专为量化设计

推荐:
- 聚宽入门版
- 日线策略足够
- 可实盘交易
```

**预算 300-1000元/月(个人进阶)**:
```
首选: 聚宽专业版(499元/月)
备选: 米筐数据(300-500元/月)

理由:
- 分钟线数据
- 更多API调用
- 策略更复杂

推荐:
- 有实盘且资金>10万: 聚宽/米筐专业版
- 偏重研究: 米筐数据
```

**预算 1000-5000元/月(个人高级/小团队)**:
```
首选: Choice金融终端(约500-700元/月按年付)
备选: 聚宽旗舰版(999元/月)

理由:
- 数据全面
- 专业工具
- 专属服务

适合:
- 专业个人投资者
- 小型工作室
- 深度研究
```

**预算 5000元+/月(机构)**:
```
选择: Wind金融终端
      Choice机构版
      通联数据

理由:
- 机构标准
- 数据最全
- 专业服务
- 合规要求
```

### 根据使用场景选择

**场景1: 纯学习,不实盘**:
```
推荐: Tushare Pro + AKShare
费用: 0元
理由: 免费,够用
```

**场景2: 日线策略实盘(资金<10万)**:
```
推荐: 聚宽入门版 or Tushare Pro捐赠版
费用: 199-200元/月
理由: 性价比高,质量可靠
```

**场景3: 日内策略(需要分钟线)**:
```
推荐: 聚宽专业版 or 米筐数据
费用: 299-499元/月
理由: 分钟线质量好,API调用充足
```

**场景4: 高频策略(需要Tick)**:
```
推荐: 通联数据 or Wind
费用: 数千-数万元/月
理由: Tick数据,低延迟,机构级
```

**场景5: 基本面研究**:
```
推荐: 聚宽专业版 or Choice
费用: 499-700元/月
理由: 财务数据全,分析工具多
```

**场景6: 因子研究**:
```
推荐: 米筐数据 or 聚宽专业版
费用: 300-500元/月
理由: 因子库丰富
```

**场景7: 机构合规要求**:
```
推荐: Wind or Choice机构版
费用: 4万-20万/年
理由: 满足合规,业内认可
```

### 决策流程图

```
开始
  |
  ├─ 你的角色?
  |  ├─ 学生/初学者 → Tushare Pro(免费)
  |  ├─ 个人投资者 → 继续↓
  |  └─ 机构 → Wind/Choice机构版
  |
  ├─ 你的预算(月)?
  |  ├─ 0元 → Tushare Pro + AKShare
  |  ├─ 100-300元 → 聚宽入门版
  |  ├─ 300-1000元 → 聚宽/米筐专业版
  |  └─ 1000元+ → Choice or 聚宽旗舰版
  |
  ├─ 你的策略频率?
  |  ├─ 日线 → 聚宽入门版够用
  |  ├─ 分钟线 → 聚宽/米筐专业版
  |  └─ Tick/高频 → 通联数据/Wind
  |
  ├─ 是否实盘?
  |  ├─ 否(只学习) → 免费数据源
  |  └─ 是 → 至少聚宽入门版
  |
  └─ 推荐方案
```

### 组合方案

**方案1: 免费组合(学习)**:
```
Tushare Pro(主) + AKShare(辅)
成本: 0元
适合: 完全新手,学习Python,开发简单策略
```

**方案2: 入门组合(小资金实盘)**:
```
聚宽入门版 + Tushare Pro(补充)
成本: 199元/月
适合: 资金<5万,日线策略,初级实盘
```

**方案3: 进阶组合(中等资金)**:
```
聚宽专业版 + 米筐(研究)
成本: 499-800元/月
适合: 资金5-50万,分钟级策略,深度研究
```

**方案4: 专业组合(大资金)**:
```
Choice + 聚宽旗舰版
成本: 1000-1700元/月
适合: 资金50万+,全方位研究,专业交易
```

**方案5: 机构组合**:
```
Wind + 通联数据(补充)
成本: 5万+/年
适合: 机构、私募、合规要求
```

---

## 6.4 另类数据源

### 舆情数据

**东方财富股吧**:
```python
# 使用AKShare获取
import akshare as ak

# 获取股吧帖子
posts = ak.stock_comment_em(symbol="000001")

# 分析情绪
positive = posts[posts['标题'].str.contains('利好|上涨|牛')].shape[0]
negative = posts[posts['标题'].str.contains('利空|下跌|熊')].shape[0]

sentiment = positive / (positive + negative)
print(f"情绪指数: {sentiment:.2f}")
```

**雪球**:
```
- 雪球用户讨论
- 大V观点
- 可通过爬虫获取
- 注意反爬机制
```

**新闻数据**:
```python
# 财经新闻
news = ak.stock_news_em(symbol="000001")

# 分析热度
热度 = news.shape[0]  # 新闻数量
```

### 卫星数据

**应用场景**:
```
- 监测停车场(消费类公司)
- 监测工厂烟囱(制造业开工率)
- 监测农田(农业估产)
- 监测港口(航运物流)

数据提供商:
- 国外: Planet Labs, Orbital Insight
- 国内: 珈和科技, 航天宏图

价格: 极贵,一般机构使用
```

### 爬虫数据

**可爬取的公开信息**:
```
1. 电商数据
   - 淘宝销量
   - 京东评价
   - 拼多多价格

2. 招聘数据
   - 公司招聘人数
   - 职位变化
   - 反映企业扩张

3. 地图数据
   - 餐厅人流
   - 商场热度
   - 景区访客

4. 社交媒体
   - 微博讨论
   - 知乎问答
   - B站播放量
```

**爬虫注意事项**:
```
⚠️ 法律风险:
- 遵守robots.txt
- 不过度请求
- 不侵犯隐私
- 不商业滥用

⚠️ 技术挑战:
- 反爬机制
- IP封禁
- 验证码
- 数据清洗
```

**爬虫框架**:
```python
# Scrapy
pip install scrapy

# Selenium(模拟浏览器)
pip install selenium

# requests + BeautifulSoup
pip install requests beautifulsoup4
```

### 区块链数据

**应用**:
```
- 监测链上地址
- 追踪大额转账
- 分析巨鲸行为
- DeFi数据

来源:
- Etherscan
- Blockchain.com
- Glassnode(付费)

适用:
- 数字货币投资
- 不适用于A股
```

---

## 6.5 数据质量与处理

### 数据质量检查

**1. 缺失值检查**:
```python
import pandas as pd

# 检查缺失
print(df.isnull().sum())

# 缺失比例
missing_ratio = df.isnull().sum() / len(df)
print(missing_ratio)

# 处理缺失
df = df.fillna(method='ffill')  # 前向填充
df = df.fillna(0)               # 填充0
df = df.dropna()                # 删除
```

**2. 异常值检查**:
```python
# 统计描述
print(df.describe())

# 检查涨跌停(异常)
df[df['pct_change'] > 15]  # 超过涨停板

# 检查成交量异常
mean_vol = df['volume'].mean()
std_vol = df['volume'].std()
异常 = df[df['volume'] > mean_vol + 3*std_vol]

# 箱线图检测
import matplotlib.pyplot as plt
df.boxplot(column='close')
plt.show()
```

**3. 一致性检查**:
```python
# 检查复权价格连续性
df['pct_change_calc'] = (df['close'] - df['close'].shift(1)) / df['close'].shift(1) * 100

# 对比官方涨跌幅
diff = abs(df['pct_change'] - df['pct_change_calc'])
异常 = df[diff > 0.01]  # 差异超过0.01%

print(f"发现{len(异常)}个不一致记录")
```

### 数据清洗

**标准流程**:
```python
def clean_stock_data(df):
    """
    清洗股票数据
    """
    # 1. 删除重复
    df = df.drop_duplicates(subset=['date'])

    # 2. 排序
    df = df.sort_values('date')

    # 3. 重置索引
    df = df.reset_index(drop=True)

    # 4. 处理缺失
    df = df.fillna(method='ffill')

    # 5. 类型转换
    df['date'] = pd.to_datetime(df['date'])
    df[['open','high','low','close']] = df[['open','high','low','close']].astype(float)

    # 6. 删除异常
    # 价格不能为0或负数
    df = df[df['close'] > 0]

    # 7. 添加衍生字段
    df['pct_change'] = df['close'].pct_change() * 100

    return df

# 使用
cleaned_data = clean_stock_data(raw_data)
```

### 数据存储

**1. CSV存储(简单)**:
```python
# 保存
df.to_csv('data.csv', index=False, encoding='utf-8-sig')

# 读取
df = pd.read_csv('data.csv', parse_dates=['date'])
```

**2. HDF5存储(快速)**:
```python
# 安装
pip install tables

# 保存
df.to_hdf('data.h5', key='stock', mode='w')

# 读取
df = pd.read_hdf('data.h5', key='stock')

# 追加
df.to_hdf('data.h5', key='stock', mode='a', append=True)
```

**3. SQLite数据库(结构化)**:
```python
import sqlite3

# 创建连接
conn = sqlite3.connect('stocks.db')

# 保存
df.to_sql('daily_data', conn, if_exists='replace', index=False)

# 查询
df = pd.read_sql('SELECT * FROM daily_data WHERE date > "2023-01-01"', conn)

# 关闭
conn.close()
```

**4. MySQL/PostgreSQL(生产环境)**:
```python
from sqlalchemy import create_engine

# 创建引擎
engine = create_engine('mysql+pymysql://user:password@localhost/database')

# 保存
df.to_sql('daily_data', engine, if_exists='append', index=False)

# 读取
df = pd.read_sql('SELECT * FROM daily_data WHERE symbol="000001.SZ"', engine)
```

**存储方案选择**:
```
CSV:
✓ 简单
✓ 通用
✗ 速度慢
✗ 占空间
→ 适合: 小数据,临时使用

HDF5:
✓ 速度快
✓ 压缩好
✗ 二进制格式
→ 适合: 本地大数据,回测

SQLite:
✓ 不需要服务器
✓ 支持SQL查询
✗ 并发差
→ 适合: 个人使用

MySQL/PostgreSQL:
✓ 专业
✓ 并发好
✓ 功能强大
✗ 需要服务器
→ 适合: 生产环境,团队
```

---

## 本章小结

本章全面介绍了量化交易的数据源,从免费到付费,从基础到高级。

### 核心要点

**1. 免费数据源**:
- **Tushare Pro**: 最流行,积分制,适合学习和简单策略
- **AKShare**: 完全免费,数据广但稳定性一般
- **交易所官方**: 权威但获取不便

**2. 付费数据源**:
- **聚宽/米筐**: 专为量化设计,性价比高,199-999元/月
- **Wind**: 机构标准,数据最全,4万+/年,个人不推荐
- **Choice**: Wind平替,6000-8000元/年,个人可考虑
- **通联数据**: 机构级高频,价格较贵

**3. 选择建议**:
```
学习阶段: Tushare Pro(免费)
初级实盘: 聚宽入门版(199元/月)
进阶实盘: 聚宽/米筐专业版(499元/月)
专业级别: Choice金融终端
机构需求: Wind
```

**4. 数据质量**:
- 质量检查: 缺失值、异常值、一致性
- 数据清洗: 去重、排序、类型转换
- 数据存储: CSV(简单)、HDF5(快速)、数据库(生产)

**5. 关键原则**:
- **学习可用免费,实盘建议付费**
- **数据质量比价格更重要**
- **选择匹配策略频率的数据**
- **本地缓存节省成本**

### 实战建议

**新手路径**:
```
1. 从Tushare Pro开始(免费)
2. 学习数据获取和处理
3. 开发简单策略
4. 验证有效后,升级聚宽入门版
5. 小资金实盘验证
6. 资金增长后升级专业版
```

**进阶路径**:
```
1. 使用聚宽/米筐专业版
2. 获取分钟线数据
3. 开发日内策略
4. 深度因子研究
5. 根据需要升级Choice或聚宽旗舰版
```

**机构路径**:
```
1. Wind金融终端(标准配置)
2. 通联数据(补充高频)
3. 另类数据(竞争优势)
4. 自建数据平台
```

### 常见错误

❌ **错误1**: 完全依赖免费数据实盘
- 质量不稳定
- 可能导致策略失效

❌ **错误2**: 盲目追求最贵的数据
- Wind对个人性价比低
- 聚宽/米筐对个人足够

❌ **错误3**: 忽视数据质量检查
- 脏数据导致错误结论
- 必须清洗验证

❌ **错误4**: 不做本地缓存
- 重复调用浪费API次数
- 增加成本

✅ **正确做法**:
- 根据预算和需求选择
- 免费学习,付费实盘
- 严格数据质量控制
- 本地缓存优化成本

---

**下一章预告**:
第七章将介绍**交易平台与接口**,学习如何对接券商API进行实盘交易,实现策略的自动化执行。包括QMT、掘金量化、vn.py等主流交易接口的详细使用指南。
